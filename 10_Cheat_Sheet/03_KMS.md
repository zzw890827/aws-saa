# KMS

1. AWS密钥管理存储(KMS)是一项托管服务，让您可以轻松地对数据进行加密。
2. AWS KMS为您提供了一个高可用的密钥存储、管理和审计解决方案，让您在自己的应用程序中加密数据，并控制整个AWS服务中存储数据的加密。
3. AWS KMS允许您集中管理和安全存储您的密钥。这些密钥被称为客户主密钥或CMK。
4. 您可以在KMS中、在AWS CloudHSM集群中生成CMK，或者从您自己的密钥管理基础设施中导入它们。
5. 这些主密钥受到硬件安全模块（HSM）的保护，并且只在这些模块内使用。
6. 您可以直接向KMS提交数据，使用这些主密钥进行加密或解密。
7. 您可以对这些密钥设置使用策略，以确定哪些用户可以使用它们来加密和解密数据，以及在什么条件下使用。
8. KMS与许多AWS服务紧密集成，如Lambda、S3、EBS、EFS、DynamoDB、SQS等。
9. AWS KMS与AWS服务和客户端工具箱集成在一起，使用一种称为信封加密的方法来加密您的数据。在这种方法下，KMS会生成数据密钥，这些数据密钥用于加密数据，本身也是用你在KMS中的主密钥进行加密的。
10. 数据键不由KMS保留或管理。
11. AWS服务对您的数据进行加密，并将数据密钥的加密副本与其保护的数据一起存储。
12. 当服务需要对您的数据进行解密时，他们会要求KMS使用您的主密钥对数据密钥进行解密。
13. 如果向AWS服务请求数据的用户根据您的主密钥策略被授权解密，服务将收到来自KMS的解密数据密钥，用它可以解密您的数据并以明文形式返回。
14. 所有使用您的主密钥的请求都会记录在 AWS CloudTrail 中，这样您就可以了解谁在什么情况下使用了哪个密钥以及何时使用了它。
15. 您可以通过IAM用户和角色控制谁管理和访问密钥。
16. 您可以通过CloudTrail审计密钥的使用情况。
17. KMS不同于Secrets Manager，因为它是专门为加密密钥管理而设计的。
18. KMS是由许多合规性方案（如PCI DSS 1级，FIPS 140-2 2级）验证的。
19. 您可以在AWS KMS中执行以下关键管理功能：
    - 创建具有独特别名和描述的钥匙。
    - 导入自己的密钥材料。
    - 定义哪些IAM用户和角色可以管理密钥。
    - 定义哪些IAM用户和角色可以使用密钥来加密和解密数据。
    - 选择让 AWS KMS 每年自动轮换您的密钥。
    - 暂时禁用密钥，使其不能被任何人使用。
    - 重新启用禁用的密钥。
    - 删除您不再使用的密钥。
    - 通过检查 AWS CloudTrail 中的日志来审计密钥的使用情况。
    - 创建自定义密钥存储*。
    - 连接和断开自定义密钥存储*。
    - 删除自定义密钥存储*。
20. 使用自定义密钥存储需要您的账户中的CloudHSM资源可用。
21. 通常情况下，数据会在以下三种情况之一进行加密：
    - 您可以直接使用KMS的API来使用存储在KMS中的主密钥对数据进行加密和解密。
    - 您可以选择让AWS服务使用存储在KMS中的主密钥对您的数据进行加密。在这种情况下，数据使用受您在KMS中的主密钥保护的数据密钥进行加密。
    - 您可以使用与AWS KMS集成的AWS加密SDK在自己的应用程序中执行加密，无论它们是否在AWS中运行。
22. 自定义密匙存储：
    - AWS KMS自定义密钥存储功能将AWS CloudHSM提供的控件与AWS KMS的集成性和易用性相结合。
    - 您可以配置自己的CloudHSM集群，并授权KMS将其作为您的密钥的专用密钥存储，而不是默认的KMS密钥存储。
    - 在所有其他方面，存储在您的自定义密钥库中的主密钥与其他KMS CMK一致。
23. 删除密匙
    - 您可以安排删除您在 AWS KMS 中创建的客户主密钥和相关的元数据，等待期可配置为7到30天。
    - 这个等待期允许您验证删除密钥对您的应用程序和依赖它的用户的影响。
    - 默认等待期为30天。
    - 您可以在等待期内取消删除钥匙。
24. 限制
    - 每个地区每个账户最多可以创建1000个客户主密钥。
    - 由于已启用和已禁用的客户主密钥均计入限制，AWS 建议删除您不再使用的禁用密钥。
    - 为在支持的 AWS 服务中使用而代表您创建的 AWS 管理主密钥不计入此限制。
    - 使用主密钥可以派生出的数据密钥的数量没有限制，可以在您的应用程序中使用，也可以由AWS服务代表您对数据进行加密。
