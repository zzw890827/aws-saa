# EBS

1. EBS卷数据的持久性与实例的寿命无关。
2. EBS卷不需要连接到一个实例。
3. 您可以将多个EBS卷附加到一个实例上。
4. 您不能将一个 EBS 卷附加到多个实例上（使用 Elastic File Store 替代）。
5. EBS卷数据在一个AZ中的多台服务器上进行复制。
6. EBS卷必须与它们所连接的实例处于同一AZ。
7. EBS的设计年故障率为0.1%-0.2%，SLA为99.95%。
8. 终止保护默认是关闭的，必须手动启用（在实例终止时保留卷/数据）。
9. 根EBS卷默认在终止时被删除。
10. 额外的非启动卷默认不会在终止时被删除。这种行为可以通过改变 "DeleteOnTermination "属性来改变。
11. 您现在可以创建具有加密根/启动卷和数据卷的AMI（您也可以为每个卷使用单独的CMK）。
12. 卷大小和类型可以在不停机的情况下进行升级（磁性标准除外）。
13. 弹性卷允许您在使用卷时增加卷的大小、调整性能或改变卷的类型。
14. 要在AZ之间迁移卷，先创建一个快照，然后从快照在另一个AZ中创建一个卷（可以改变大小和类型）。
15. 自动启用IO设置可以防止AWS检测到不一致时停止对磁盘的IO。
16. 根设备在/dev/sda1或/dev/xvda下创建。
17. 磁性EBS适用于需要吞吐量而非IOPS的工作负载。
18. 吞吐量优化的EBS卷不能成为引导卷。
19. 您启动的每个实例都有一个相关的根设备卷，可以是Amazon EBS卷，也可以是实例存储卷。
20. 您可以使用块设备映射来指定额外的EBS卷或实例存储卷，以便在实例启动时将其附加到实例上。
21. 您还可以将额外的EBS卷附加到正在运行的实例中。
22. 您不能减少EBS的体积大小。
23. 当改变卷时，新卷必须至少是当前卷快照的大小。
24. 镜像可以公开，但如果是加密的就不行。
25. AMI可以与其他账户共享。
26. 默认情况下，您最多可以拥有5000个EBS卷。
27. 默认情况下，您最多可以拥有10,000个快照。

## 实例存储

1. 实例存储为您的实例提供临时（非持久）块级存储。这与EBS不同，EBS提供的是持久化存储，但也是一种块存储服务，可以是根卷或附加卷。
2. 实例存储空间位于物理连接到主机的磁盘上。
3. 实例存储非常适合临时存储经常变化的信息，如缓冲区、缓存、抓取数据和其他临时内容，或者用于在实例群中复制的数据，如负载平衡的Web服务器池。
4. 只有在启动实例时才能为其指定实例存储卷。
5. 您不能从一个实例中分离出一个实例存储卷，并将其附加到另一个实例中。
6. 实例类型决定了可用实例存储的大小和实例存储卷的硬件类型。
7. 实例存储卷包含在实例的使用成本中。
8. 一些实例类型使用NVMe或基于SATA的固态硬盘（SSD）来提供高随机I/O性能。
9. 当你需要具有非常低延迟的存储时，这是一个很好的选择，但当实例终止时你不需要数据持久化，或者你可以利用容错架构。
10. 考试技巧：实例存储提供了非常高的性能和低延迟。只要你能承受失去一个实例，即你正在复制你的数据，这些可以是一个很好的高性能/低延迟要求的解决方案。注意那些提到需要高I/O的分布式或复制数据库的问题。另外，请记住，实例存储的成本包含在实例收费中，所以它也可以比EBS Provisioned IOPS更划算。

## EBS vs 实例存储

1. EBS-backed表示根卷是EBS卷，存储是持久的。
2. 实例存储支持是指根卷是实例存储卷，存储不持久。
3. 在EBS支持的实例上，默认操作是在终止时删除EBS根卷。
4. 实例存储卷有时被称为Ephemeral存储（非持久性）。
5. 实例存储备份的实例不能停止。如果底层主机发生故障，数据将丢失。
6. 实例存储卷根设备由存储在S3上的AMI模板创建。
7. EBS备份的实例可以被停止。如果停止（持久化），你不会丢失这个实例的数据。
8. EBS卷可以分离并重新连接到其他EC2实例。
9. EBS卷根设备是从AMI启动的，而AMI是由EBS快照支持的。
10. 实例存储卷不能被分离/重接。
11. 当重启这两种类型的实例时，数据将不会丢失。
12. 默认情况下，两个根卷都会在终止时被删除，除非您另有配置。

## EBS卷的种类

- SSD, General Purpose – GP2.
  - 每GiB 3 IOPS，最低100 IOPS的基准。
  - 爆发力高达3000 IOPS（对于容量>=334GB）。
  - 每卷最高可达 16,000 IOPS。
  - AWS设计的gp2卷可以在99%的时间内提供90%的供应性能。一个gp2卷的大小可以从1 GiB到16 TiB不等。
- SSD, Provisioned IOPS - I01.
  - 超过16,000 IOPS。
  - 每卷最高可达 64,000 IOPS。
  - 每GiB高达50 IOPS。
  - 亚马逊EBS可在99.9%的时间内提供配置的IOPS性能。
- HDD, Throughput Optimized – (ST1):
  - 具有大数据集和大I/O规模的频繁访问、吞吐量密集型工作负载，如MapReduce、Kafka、日志处理、数据仓库和ETL工作负载。
  - 吞吐量以MB/s为单位，包括每TB最高250MB/s的突发能力，每TB基线吞吐量为40MB/s，每卷最大吞吐量为500MB/s。
  - 不能成为引导卷。
- HDD, Cold – (SC1):
  - 最低成本的存储--不能是启动卷。
  - 具有大型、冷数据集的不常访问的工作负载。
  - 这些卷可以爆发到每TB 80 MB/s，基线吞吐量为每TB 12 MB/s，每卷最大吞吐量为250 MB/s。
- 硬盘，磁性 - 标准 - 廉价的，不经常访问的存储 - 可以作为启动卷的最低成本存储。
- EBS优化实例。
  - 亚马逊EBS I/O的专用容量。
  - EBS优化的实例设计用于所有EBS卷类型。
  - 最大带宽：400 Mbps-12000 Mbps。
  - IOPS: 3000 – 65000.
  - GP-SSD的基线10%以内，突发性能99.9%。
  - PIOPS在基线的10%以内，爆发性能99.9%。
  - 额外的小时费。
  - 适用于选定的实例类型。
  - 一些实例类型默认启用了EBS优化。

## 快照

1. 快照捕获一个实例的时间点状态。
2. 成本效益高，备份策略简单。
3. 与其他用户或账户共享数据集。
4. 可用于将系统迁移到一个新的AZ或地区。
5. 可用于将未加密卷转换为加密卷。
6. 快照存储在Amazon S3上。
7. 不提供精细化备份（不能替代备份软件）。
8. 如果您定期对卷进行快照，则快照是增量的，这意味着只有在上次快照后发生变化的设备上的块才会保存在新的快照中。尽管快照是以递增方式保存的，但快照删除过程的设计使您只需要保留最近的快照，以便恢复卷。
9. 快照只能通过EC2 API访问。
10. EBS卷是针对AZ的，但快照是针对区域的。
11. 可以从大小相同或更大的EBS快照创建卷。
12. 可以在运行时对非根EBS卷进行快照。
13. 为了采取一致的快照，必须停止（暂停）写入，直到快照完成--如果不可能，需要分离卷，或者如果是EBS根卷，必须停止实例。
14. 为了降低S3上的存储成本，可以创建一个完整的快照和后续的增量更新。
15. 您需要支付到S3的数据流量和S3上的存储费用。
16. 您只需支付更改后的区块的费用。
17. 删除快照只删除其他快照不需要的数据。
18. 您可以通过恢复不同大小的快照来调整卷的大小（在拍摄快照时配置）。
19. 快照可以在区域之间复制（并加密）。然后从另一个区域的快照中创建映像，从而创建一个AMI，可用于启动实例。
20. 您可以从快照中创建卷，并选择区域内的可用性区域。

## 加密

1. 您可以对EC2实例的启动卷和数据卷进行加密。当您创建加密的EBS卷并将其附加到支持的实例类型时，以下类型的数据将被加密。
   - 卷内静止的数据。
   - 所有在卷和实例之间移动的数据。
   - 从卷中创建的所有快照。
   - 从这些快照创建的所有卷。
2. 所有EBS卷类型都支持加密。
3. 加密卷和未加密卷的IOPS性能相同。
4. 所有实例族都支持加密。
5. EBS使用行业标准的AES-256算法，用数据密钥对您的加密卷进行加密。
6. 您的数据密钥与您的加密数据一起存储在磁盘上，但在EBS与您的CMK加密之前不会出现。您的数据密钥永远不会以明文形式出现在磁盘上。该卷的快照和从这些快照创建的任何后续卷共享同一数据键。
7. 加密卷的快照会自动加密。
8. 从加密快照恢复的EBS卷是自动加密的。
9. 从加密快照创建的EBS卷也是加密的。
10. 你可以共享快照，但如果快照是加密的，就必须使用自定义CMK密钥。
11. 没有直接的方法来改变卷的加密状态。
12. 要么创建一个加密卷并将数据复制到该卷，要么取一个快照，对其进行加密，然后从快照中创建一个新的加密卷。
13. 要加密卷或快照，您需要一个加密密钥，这些是客户管理密钥（CMK），它们由AWS密钥管理服务（KMS）管理。
14. 第一个加密卷会生成一个默认的CMK密钥。随后的加密卷将使用自己的唯一密钥（AES 256位）。
15. 用于加密卷的CMK被任何快照和从快照创建的卷使用。
16. 您不能共享使用默认CMK密钥创建的加密卷。
17. 您不能更改用于加密卷的CMK密钥。
18. 您必须创建快照的副本，并更改加密密钥作为副本的一部分。这是为了能够共享加密卷而需要的。
19. 默认情况下，只有账户所有者可以从快照创建卷。
20. 你可以通过公开未加密的快照与AWS社区分享。
21. 您还可以通过将未加密的快照设为私有并选择要与之共享的账户，与其他AWS账户共享。
22. 您不能公开加密的快照。
23. 您可以使用非默认的CMK密钥与其他AWS账户共享加密快照，并配置跨账户权限，让该账户访问密钥，标记为私有，并配置账户共享。接收账户必须先复制快照，然后才能从快照中创建卷。
24. 建议接收账户使用自己的CMK密钥重新加密共享和加密的快照。
25. 以下信息适用于快照：
    - 快照是异步创建的，而且是增量的。
    - 您可以复制未加密的快照（可选择加密）。
    - 你可以复制一个加密的快照（可以选择用不同的密钥重新加密）。
    - 快照副本会收到一个新的唯一ID。
    - 您可以在区域内或区域间复制。
    - 您不能移动快照，只能复制它们。
    - 当快照处于 "待定 "状态时，你不能复制快照，它必须是 "完整 "的。
    - S3服务器端加密(SSE)可以在复制时保护传输中的数据。
    - 用户定义的标签不会被复制。
    - 每个账户最多可以在一个目标中运行5个快照复制请求。
    - 您可以复制导入/导出服务、AWS Marketplace 和 AWS 存储网关快照
    - 如果您试图在没有访问加密密钥的情况下复制加密快照，将无声地失败（需要跨账户权限）。
26. 复制快照可能需要：
    - 在其他区域建立服务。
    - DR - 从另一个区域的快照恢复的能力。
    - 移徙到另一个地区；
    - 应用加密技术。
    - Data retention.
27. 对RAID阵列进行与应用一致的快照。
    - 停止应用程序向磁盘写入。
    - 将所有的缓存刷新到磁盘上。
    - 冻结文件系统。
    - 卸载RAID阵列。
    - 关闭相关的EC2实例。

## AIMs

1. AMI是一种特殊类型的虚拟设备，用于在EC2中创建虚拟机。
2. 一个AMI包括以下内容：
   - 实例的根卷的模板（例如，操作系统、应用服务器和应用程序）。
   - 启动权限，控制哪些 AWS 账户可以使用 AMI 启动实例。
   - 一个块设备映射，指定实例启动时要附加到实例的卷。
3. AMI可以是实例存储支持的，也可以是EBS支持的。
4. 实例存储支持：
   - 从AWS实例存储支持的AMI启动EC2实例。
   - 根据需要更新根卷。
   - 创建AMI，它将上传到用户指定的S3 bucket（用户桶）。
   - 用EC2注册AMI（创建另一个EC2控制的S3镜像）。
   - 要进行更改，先更新源码，然后注销注册并重新注册。
   - 启动后，镜像会被复制到EC2主机上。
   - 当不再需要AMI时，取消注册镜像（不影响从AMI创建的现有实例）。
   - 实例存储备份卷只能在启动时创建。
5. EBS支持的：
   - 必须停止实例以创建一致的镜像，然后创建AMI。
   - AWS自动注册AMI。
   - 在创建过程中，AWS会创建所有连接卷的快照--不需要指定一个桶，但你会对S3上的存储收费。
   - 只要AMI已注册（注销和删除），您就不能删除根卷的快照。
   - 现在，您可以创建具有加密根/启动卷和数据卷的AMI（也可以为每个卷使用单独的CMK）。
6. 复制快照
   - 您可以使用 AWS 管理控制台、AWS AWS 命令行接口或 SDK 或 Amazon EC2 API 在 AWS 区域内或跨区域复制亚马逊机器映像 (AMI)，所有这些都支持 CopyImage 动作。
   - 您可以复制 Amazon EBS 支持的 AMI 和实例商店支持的 AMI。
   - 您可以复制加密的AMI和带有加密快照的AMI。

## RAID

1. RAID可以用来增加IOPS。
2. RAID 0 = 0条带化--数据写入多个磁盘，提高了性能，但没有冗余。
3. RAID 1 = 1个镜像--创建2个数据副本，但不提高性能，只增加冗余。
4. RAID 10 = 10个RAID 1和2的组合，提高了性能和冗余度（以额外的磁盘为代价）。
5. 您可以配置多个带状 gp2 或标准卷（通常为 RAID 0）。
6. 您可以配置多个条状PIOPS卷（通常是RAID 0）。
7. RAID是通过客户操作系统配置的。
8. EBS优化EC2实例是提高性能的另一种方式。
9. 确保EC2实例能够处理提高性能所需的带宽。
10. 使用EBS优化的实例或具有10 Gbps网络接口的实例。
11. 不建议对根卷/启动卷使用RAID。
